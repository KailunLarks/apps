---
import { getCollection, type CollectionEntry } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import Sidebar from '../../components/Sidebar.astro';

// 定义研究项类型
interface ResearchItem {
  slug: string;
  title: string;
  location: string;
  summary: string;
  tags: string[];
  cover: string;
  date: string;
}

// 从 content 目录读取研究数据
const researchEntries = await getCollection('research');

// 按日期排序（最新的在前）
const researchItems: ResearchItem[] = researchEntries
  .map((entry): ResearchItem => ({
    slug: entry.slug,  // 使用 Astro 自动生成的 slug
    title: entry.data.title,
    location: entry.data.location,
    summary: entry.data.summary,
    tags: entry.data.tags,
    cover: entry.data.cover,
    date: entry.data.date.toISOString().split('T')[0],  // Date 转为字符串
  }))
  .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());
---

<Layout title="研究展示">
  <div class="flex min-h-screen">
    <Sidebar />
    
    <main class="flex-1 ml-64 p-8 overflow-y-auto">
      <div class="max-w-6xl mx-auto">
        <!-- 页面标题 -->
        <header class="mb-8">
          <h1 class="text-3xl font-bold text-neutral-14">研究展示</h1>
          <p class="mt-2 text-neutral-10">探索海甸岛的历史变迁与发展研究</p>
        </header>

        <!-- 研究卡片网格 -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {researchItems.map((item: ResearchItem) => (
            <a
              href={`/research/${item.slug}`}
              class="group block bg-white rounded-xl overflow-hidden shadow-sm hover:shadow-lg transition-shadow border border-neutral-3"
            >
              <!-- 封面图 -->
              <div class="aspect-video bg-neutral-3 relative overflow-hidden">
                <div class="absolute inset-0 bg-gradient-to-br from-primary-3 to-primary-6 opacity-60" />
                <div class="absolute inset-0 flex items-center justify-center">
                  <span class="text-white text-lg font-medium">{item.title}</span>
                </div>
              </div>
              
              <!-- 内容区 -->
              <div class="p-4">
                <h2 class="text-lg font-semibold text-neutral-14 group-hover:text-primary-8 transition-colors">
                  {item.title}
                </h2>
                
                <div class="flex items-center gap-1 mt-1 text-sm text-neutral-10">
                  <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" />
                    <circle cx="12" cy="10" r="3" />
                  </svg>
                  <span>{item.location}</span>
                </div>
                
                <p class="mt-3 text-sm text-neutral-12 line-clamp-2">
                  {item.summary}
                </p>
                
                <div class="flex items-center justify-between mt-4">
                  <div class="flex gap-2">
                    {item.tags.map((tag: string) => (
                      <span class="px-2 py-0.5 text-xs bg-primary-1 text-primary-8 rounded-full">
                        {tag}
                      </span>
                    ))}
                  </div>
                  <span class="text-xs text-neutral-8">{item.date}</span>
                </div>
              </div>
            </a>
          ))}
        </div>
      </div>
    </main>
  </div>
</Layout>
